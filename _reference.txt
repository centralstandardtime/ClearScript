== The StateScript Language ==
StateScripts have their own language, so it is important to get familiar with it if you plan on using StateScripts. It is similar to [[Custom Behaviors]] in that it is simply a list of commands that are run in sequential order, from top to bottom, sometimes waiting for a command to finish. Certain commands may change what line the StateScript is on. Each command MUST be separated with a line break, meaning two commands cannot be on the same line. This means the map-maker must write StateScripts in an external text editor and then copy-paste them into Roblox Studio, as Roblox Studio by default doesn't allow line breaks when writing Attributes directly.

=== Preprocessing ===
There are two steps of preprocessing with StateScripts: startup preprocessing, and line preprocessing.

Startup preprocessing does two things: it runs any INIT commands (see list of commands) and it changes all variables prefixed with a # symbol to become "private" variables. "Private" variables are very hard to access outside of StateScripts, and should be used when there is some kind of variable you only want accessible through this StateScript.

Line preprocessing is triggered only when a line begins with a * symbol. This causes the line to be treated as a String Expression (see [[Expression Parsing]]) before it is run. As an example, let's say Index is equal to 2. <code>*SET Array{Index} 0</code> will be run through the Expression system before being run, and, upon being processed, will be run as <code>SET Array2 0</code> This can be expensive and should only be used when necessary.

=== Custom Attributes ===
Any Attribute applied to a StateScript will be turned into a "private" variable, usable by that script via the # symbol, as explained above. So for example, placing an attribute named "DelayTime" with a value of "5" on a StateScript, will then allow that value of "5" to be accessed within the StateScript via <code>#DelayTime</code>. So, for example, running <code>SET TimeUntilMissionEnd #DelayTime</code> will set TimeUntilMissionEnd to whatever the value of the DelayTime attribute on this StateScript is.

Custom Attributes are treated as strings, not Expressions or Variables. If an attribute is set to "5 + 3" then accessing that attribute will give you "5 + 3" and not "8". If you want to treat it like an Expression (or even a variable!) you must wrap it in curly brackets, like so: <code>SET ThisWillBe8 {#AttributeThatIs5Plus3}</code>

=== Formatting ===
All commands must have their arguments separated by spaces. If you want a specific argument to include spaces, you must wrap it in square brackets [ ]. If you want to use a string, simply use double square brackets. Anything inside square brackets is treated as a String expression.

=== Debugging ===
StateScripts have two built in variables: DebugVariable and DebugLineVariable. DebugVariable will always be a string containing the current line's contents, while DebugLineVariable will always contain the current line number of the current StateScript. Use these to see if and why a StateScript stops unexpectedly.

=== The Stack ===
The stack is a place that can contain multiple values. It can be viewed as a pile of playing cards. You can draw cards from the pile, but only ever the top card. You can also put more cards in the pile, but again only from the top. When you insert a new value to the stack using PUSH or CALL, it is put "on top" of the values already present in the stack. To remove a value from the stack, you have to use POP. This will remove the top value from the stack, and put it in a variable of your choice. If you want to access the top value of the stack, without removing it from the stack, you can use PEEK.
The stack is not preserved between statescript runs, so if you run the same statescript multiple times, every run will have a unique stack.

== Commands ==
=== INIT ===
Format: <code>INIT [Variable] [Value]</code>

Example: <code>INIT Five 5</code>

Initializes a variable in Global space. Similar to defining a variable in Globals.

=== KILL ===
Format: <code>KILL</code>

Example: <code>KILL</code>

Immediately ends this script's execution.

=== INC/INCREMENT ===
Format: <code>[INC || INCREMENT] [Variable]</code>

Example: <code>INC TimesRun</code>

Increments a Global Variable by 1.

=== DEC/DECREMENT ===
Format: <code>[DEC || DECREMENT] [Variable]</code>

Example: <code>DECREMENT TimesRun</code>

Decrements a Global Variable by 1.

=== SET ===
Format: <code>SET [Variable] [Value]</code>

Example: <code>SET CashAmount 2</code>

Sets a Global Variable to a value. Cannot create new Global Variables.

=== ALLOC ===
Format: <code>ALLOC [Variable]</code>

Example: <code>ALLOC JohnKilled</code>

Creates a new Global Variable by a specific name and sets it to 0. Can be used to create variables at runtime that you may not know the name of ahead of time.

=== ALLOCARRAY ===
Format: <code>ALLOCARRAY [Variable] [Count]</code>

Example: <code>ALLOCARRAY Test 4</code>

Creates new variables from Variable0 to Variable[Count-1]. The above example creates Test0, Test1, Test2, and Test3.

=== GOTO ===
Format: <code>GOTO [Label] [Condition?]</code>

Example: <code>GOTO WinBig GotAll7s</code>

Sets the current line of this StateScript to a label. See below for labels. Condition is optional and, if provided, will only cause the GOTO to execute if the condition is true.

=== LABEL ===
Format: <code>:[LabelName]</code>

Example: <code>:WinBig</code>

Creates a label at this line. When a GOTO command is executed with this LabelName as it's Label, then the command immediately after this Label will be executed and the script will continue on from there.

=== CALL ===
Format: <code>CALL [Label] [Arg0...]</code>

Example: <code>CALL TeleportGuy LoadingArea</code>

Identical to GOTO, with one catch: the next RETURN command will bring this StateScript back to right below this CALL command. Additionally, arguments can be provided, which will be pushed onto the Stack until RETURN is called. If multiple CALLs are nested, RETURN will always go back to the most recent CALL.

=== CALLIF ===
Format: <code>CALLIF [Label] [Condition] [Arg0...]</code>

Example: <code>CALLIF TeleportGuy HasMagicPowers LoadingArea</code>

Identical to CALL, but will only run if Condition is true.

=== RETURN ===
Format: <code>RETURN</code>

Example: <code>RETURN</code>

Goes back to the most recent CALL or CALLIF run. If there is no most recent CALL or CALLIF run, this functions as KILL.

=== THREAD ===
Format: <code>THREAD [Label] [Arg0...]</code>

Example: <code>THREAD WaitThenTeleportGuy LoadingArea</code>

Splits the script into two versions. The new version will have it's own fresh Stack with values provided by Arg0 (and onwards), and will begin at Label, while the other version will continue right after this THREAD command with the existing Stack.

=== PUSH ===
Format: <code>PUSH [Value]</code>

Example: <code>PUSH TeleportLocation</code>

Adds a new value to the top of this script's Stack.

=== POP ===
Format: <code>POP [Variable]</code>

Example: <code>POP TeleportDestination</code>

Removes the value at the top of this script's Stack and places it into Variable.

=== PEEK ===
Format: <code>PEEK [Variable]</code>

Example: <code>PEEK NextTeleportDestination</code>

Identical to POP, except it does not remove the value off of the Stack.

=== WAIT ===
Format: <code>WAIT [Time] [Variable?]</code>

Example: <code>WAIT 5 ActualWaitTime</code>

Pauses this script for Time seconds. If Variable is set, then Variable will be set to the ''actual'' amount of time this delay took, as the WAIT command is not always perfectly accurate.

=== WAITHEARTBEAT ===
Format: <code>WAITHEARTBEAT [Variable?]</code>

Example: <code>WAITHEARTBEAT TickTime</code>

Waits for one in-engine tick, typically 1/60th of a second. If Variable is set, then Variable will be set to the ''actual'' amount of time this delay took.

=== WAITFOR ===
Format: <code>WAITFOR [Expression]</code>

Example: <code>WAITFOR GuyArrived</code>

Pauses this script until Expression becomes true. Be careful when using line preprocessing with this command, as line preprocessing is only done at the very beginning of the waiting period. For example, <code>*WAITFORM {Condition}</code> will wait forever if Condition is not true when this command is first run, as the preprocessor turns this line into <code>WAITFOR 0</code> in that case.

=== WAITFORCHANGE ===
Format: <code>WAITFORCHANGE [Expression]</code>

Example: <code>WAITFORCHANGE NumberRolled</code>

Identical to WAITFOR, but instead waits for Expression to change it's value instead of simply waiting for it to become true.

=== SHUFFLE ===
Format: <code>SHUFFLE [OutputVariable] [Seed] [Item1...]</code>

Example: <code>SHUFFLE Output 34891 1 2 3 4</code>

Shuffles a set of values randomly into several numbered variables prefixed with OutputVariable. For example, the example command above has a chance to set <code>Output0</code> to 3, <code>Output1</code> to 1, <code>Output2</code> to 2, and <code>Output3</code> to 4.

=== GUID ===
Format: <code>GUID [Variable]</code>

Example: <code>GUID RandomNumber</code>

Generates a fully random GUID and sets Variable to that value.

=== LERP ===
Format: <code>LERP [Variable1] [Variable2] [Alpha] [Output]</code>

Example: <code>LERP BeginMeter EndMeter Progress MeterValue</code>

Performs Linear Interpolation between Variable1 and Variable2 and places the result into Output.

=== CFR ===
Format: <code>CFR [Variable] [CFrame?]</code>

Example: <code><nowiki>CFR #Placement [[4, 2, 8]]</nowiki></code>

Creates a new CFrame value, using CFrame as a string to represent what you would place into CFrame.new() in Roblox Studio.

=== CFRANGLES ===
Format: <code>CFRANGLES [Variable] [Angles]</code>

Example: <code>CFRANGLES Rotation <nowiki>[[3.14, 0, 0]]</nowiki></code>

Identical to CFR, but instead of creating via CFrame.new(), it creates a CFrame using CFrame.Angles(). Note that CFrame.Angles() expects radians and not degrees.

=== CFRDEGREES ===
Format: <code>CFRDEGREES [Variable] [Angles]</code>

Example: <code><nowiki>CFRDEGREES Rotation [[180, 0, 0]]</nowiki></code>

Identical to CFRANGLES, but instead converts your provided values from degrees to radians automatically.

=== CFRINV ===
Format: <code>CFRINV [Variable] [InvertedResult?]</code>

Example: <code>CFRINV Offset OppositeSide</code>

Sets InvertedResult to an inverted version of the CFrame contained in Variable. If InvertedResult isn't specified, then the output will be put into Variable.

=== CFRCOPY ===
Format: <code>CFRCOPY [Variable] [PropTag]</code>

Example: <code>CFRCOPY ParkingSpot ParkingSpotMarker</code>

Copies the CFrame of the most recently created prop with PropTag into Variable.

=== MOVETO ===
Format: <code>MOVETO [PropTag] [Location]</code>

Example: <code>MOVETO Van ParkingSpot</code>

Teleports the most recently created prop with PropTag to the CFrame specified by Location.
{{Note|If a part is moved by MOVETO (or any of its variations) then this part MUST have an Attribute named "ScriptMove"!!}}

=== ANIMATE ===
Format: <code>ANIMATE [PropTag] [Location] [Time]</code>

Example: <code>ANIMATE Van ParkingSpot 5</code>

Identical to MOVETO, but instead of teleporting, it moves the prop over the course of Time seconds.

=== ANIMATECUBIC ===
Format: <code>ANIMATECUBIC [PropTag] [Location] [Time]</code>

Example: <code>ANIMATECUBIC Van ParkingSpot 5</code>

Identical to ANIMATE, but instead of moving at a fixed rate of speed, it applies cubic interpolation (as opposed to linear interpolation) giving the movement smoother starts and stops.

=== COPYTO ===
Format: <code>COPYTO [PropTag] [Location] [NewTag] [Attribute1] [Value1] [Attribute2] [Value2]...[</code>

Example: <code>COPYTO Tag0 Location Tag1 Seed [RNG 1234 1 100] Color0 Metal</code>

Similar to MOVETO, but instead of teleporting the most recently created prop with PropTag, it creates a brand new prop that copies all the attributes of the most recently created prop with PropTag. Additional attributes can be added by adding them to the end (Attribute1, Value1, etc.)

=== DELETE ===
Format: <code>DELETE [PropTag]</code>

Example: <code>DELETE WallBlockade</code>

Deletes the most recently created prop with PropTag. Calling this multiple times will only delete a prop the first time, as only the most recent prop with a tag is stored and all others become unaffected by this command after a new prop takes its place as "most recently created."

=== DELETEALL ===
Format: <code>DELETEALL [Tag]</code>

Example: <code>DELETEALL Barricade</code>

Identical to DELETE, but instead deletes all props with Tag. This is slow.

=== SPAWNBOT ===
Format: <code>SPAWNBOT [TemplateName] [CFrameVariable] [Attribute1] [Value1]...</code>

Example: <code>SPAWNBOT KellyTemplate KellySpawn Inv F57</code>

Spawns an NPC using a template from [[BotTemplates]]. Attributes can be overridden by specifying their name and value after the command (where Attribute1, Value1, etc. are)

=== INITSTATECOMP ===
Format: <code>INITSTATECOMP [TemplateName] [Attribute1] [Value1]...</code>

Example: <code>INITSTATECOMP TimerTemplate Time 50</code>

Creates a new StateComponent using a template from StateComponentTemplates, overriding any attributes listed via Attribute1, Value1, etc.
